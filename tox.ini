[tox]
requires = tox>=4
envlist = types, py{38,39,310}
skip_missing_interpreters = true

[testenv]
description = Run the tests with pytest.
package = wheel
wheel_build_env = .pkg
extras = test
commands =
    pytest {tty:--color=yes} {posargs}

[testenv:types]
description = Check static type annotations with mypy.
extras = train, types
base_python = py310
setenv =
    PIP_EXTRA_INDEX_URL=https://download.pytorch.org/whl/cpu
    PIP_CONSTRAINTS=requirements/all.txt
    MYPY_CACHE_DIR={env_dir}/.mypy_cache
commands =
    mypy --no-install-types --interactive {posargs:src scripts tests}
